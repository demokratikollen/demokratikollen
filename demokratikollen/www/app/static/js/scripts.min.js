function prop(t){return function(e){return e[t]}}function compose(t,e){return function(n){return t(e(n))}}demokratikollen={},demokratikollen.utils={},demokratikollen.graphics={},function(t){t.parties=d3.map([{key:"v",color:"#af0000"},{key:"fi",color:"#d9308e"},{key:"pp",color:"#572b85"},{key:"s",color:"#ee2020"},{key:"mp",color:"#83cf39"},{key:"sd",color:"#dddd00"},{key:"nyd",color:"#dddd00"},{key:"-",color:"#bbbbbb"},{key:"c",color:"#009933"},{key:"m",color:"#1b49dd"},{key:"fp",color:"#6bb7ec"},{key:"kd",color:"#231977"}],function(t){return t.key}),t.colors=d3.map([{key:"green",color:"#4cd42f"},{key:"yellow",color:"#ebeb2b"},{key:"red",color:"#cb1310"}],function(t){return t.key}),t.parties.forEach(function(e,n){t.colors.set(e,{key:n.key,color:n.color})}),t.getPartyColor=function(t){return d3.rgb(demokratikollen.utils.colors.get(t.toLowerCase()).color)},t.pageState=function(t){var e="-",n={},r=[];for(var a in t)t.hasOwnProperty(a)&&(n[a]=t[a],r.push(a));if(r.sort(),location.hash.length>1){var o=location.hash.substr(1).split(e);o.length==r.length?o.forEach(function(t,e){""==t&&(t=null);var a=parseInt(t,10);isNaN(a)||(t=a),n[r[e]]=t}):console.log("Warning: given pageStatus hash not compatible with state specification.")}return function(t){if(t.length){var a=t;if(n.hasOwnProperty(a))return n[a]}for(var a in t)t.hasOwnProperty(a)&&n.hasOwnProperty(a)&&(n[a]=t[a]);var o=r.map(function(t){return n[t]}).join(e);location.hash="#"+o}}}(demokratikollen.utils),demokratikollen.graphics.AppointmentsTimeline=function(){function t(t){return d3.min(t,function(t){return t.startDate})}function e(t){return d3.max(t,function(t){return t.endDate})}function n(n,r){return maxDates=[e(n.values),e(r.values)],maxDates[0]!=maxDates[1]?maxDates[1]-maxDates[0]:t(r.values)-t(n.values)}function r(t){return t.reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[])}function a(a){a.each(function(a){dataByRowLabel=d3.nest().key(function(t){return t.rowLabel}).entries(a),dataByRowLabel.sort(n);var h=dataByRowLabel.map(function(t){return t.key}),m=t(a),y=e(a),x=this.getBoundingClientRect().width-i.left-i.right,v=h.length*o,b=d3.select(this).append("svg").classed(g,!0).attr("width",x+i.left+i.right).attr("height",v+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")");b.append("rect").attr("width",x).attr("height",v).classed("background",!0);var k=d3.time.scale().domain([m,y]).range([0,x]).nice(c),w=d3.scale.ordinal().domain(h).rangePoints([0,v],1),A=k.ticks(Math.floor(x/u));A=r(A.map(c.floor));var C=d3.svg.axis().scale(k).orient("top").tickSize(-v,0).tickValues(A);C=b.append("g").classed("axis x",!0).call(C),C.selectAll("text").style("text-anchor","start"),b.append("g").classed("rowLabels",!0).selectAll("rowLabels").data(h).enter().append("text").text(function(t){return t}).attr("transform",function(t){return"translate("+s+","+w(t)+")"});var D=d3.svg.line().x(function(t){return k(t[0])}).y(function(t){return w(t[1])});linesSelection=b.append("g").attr("transform",function(){return"translate(0,"+l+")"}).classed("lines",!0).selectAll("lines").data(a).enter(),lines=linesSelection.append("path").attr("d",function(t){return D([[t.startDate,t.rowLabel],[t.endDate,t.rowLabel]])}).attr("class",function(t){return t.cssClass||""}),linesSelection.append("circle").attr("cx",function(t){return k(t.startDate)}).attr("cy",function(t){return w(t.rowLabel)}).attr("r",p),linesSelection.append("circle").attr("cx",function(t){return k(t.endDate)}).attr("cy",function(t){return w(t.rowLabel)}).attr("r",p),d&&(tip=d3.tip().attr("class","d3-tip timeline").direction(function(t){var e=k(t.startDate),n=k(t.endDate),r=x/2;return r>=e&&n>=r?"s":e>=r?"sw":r>=n?"se":void 0}).offset(function(t){var e=k(t.startDate),n=k(t.endDate),r=(e+n)/2,a=x/2;return a>=e&&n>=a?[f/2+1,a-r]:e>=a?[f/2+1,-f/3]:a>=n?[f/2+1,f/3]:void 0}).html(d),linesSelection.append("path").style("stroke","rgba(0,0,0,0)").style("stroke-width",f).attr("d",function(t){return D([[t.startDate,t.rowLabel],[t.endDate,t.rowLabel]])}).call(tip).on("mouseover",tip.show).on("mouseout",tip.hide))})}var o=40,l=10,i={top:40,right:0,bottom:5,left:0},s=10,c=d3.time.year,u=100,d=null,p=4,g="timeline",f=o-15;return a.tipHtml=function(t){return arguments.length?(d=t,a):d},a.timeUnit=function(t){return arguments.length?(c=t,a):c},a.tickLabelWidth=function(t){return arguments.length?(u=t,a):u},a},demokratikollen.graphics.horizontalBarChart=function(){function t(t){t.each(function(t){var i=d3.select(this),s=i.selectAll("g").data([0]);s.enter().append("g").attr("transform","translate("+n.left+","+n.top+")");var c=a-n.left-n.right,u=Math.min(o,l*t.length)-n.top-n.bottom,d=r*u/t.length,p=d3.scale.ordinal().domain(d3.range(t.length)).rangeBands([u,0]),g=d3.max(t,prop("value")),f=d3.scale.linear().domain([0,g]).range([0,c]),h=s.selectAll(".title-text").data([0]);h.enter().append("text").attr("class","title-text"),h.text(e).style("text-anchor","middle").attr("x",c/2).attr("y",-n.top).attr("dy","1.5em");var m=s.selectAll(".bar-rect").data(t,prop("title"));m.enter().append("rect").attr("class","bar-rect"),m.attr("y",function(e,n){return p(n)+.5*u/t.length}).attr("x",0).attr("width",function(t){return f(t.value)}).attr("height",d).style("fill",prop("color")),m.exit().style("fill-opacity",1e-5).remove(),barTexts=s.selectAll(".bar-text").data(t,prop("title")),barTexts.enter().append("text").attr("class","bar-text"),barTexts.text(function(t){return t.value}).style("text-anchor","start").style("alignment-baseline","middle").attr("x",function(t){return f(t.value)}).attr("dx","0.4em").attr("dy","0.1em").attr("y",function(e,n){return p(n)+.5*u/t.length+.5*d}),barTexts.exit().remove(),barTitles=s.selectAll(".bar-title").data(t,prop("title")),barTitles.enter().append("text").attr("class","bar-title"),barTitles.text(function(t){return t.title}).attr("x",0).attr("dy","-0.2em").attr("y",function(e,n){return p(n)+.5*u/t.length}),barTitles.exit().remove()})}var e="",n={top:40,right:50,bottom:0,left:0},r=.4,a=400,o=200,l=40,i=null;return t.onBarActivated=function(e){return arguments.length?(i=e,t):i},t.width=function(e){return arguments.length?(a=e,t):a},t.height=function(e){return arguments.length?(o=e,t):o},t.maxAbsoluteBandWidth=function(e){return arguments.length?(l=e,t):l},t.title=function(n){return arguments.length?(e=n,t):e},t},demokratikollen.graphics.mapChart=function(t){function e(t){return function(e){return e[t]}}function n(n){n.each(function(n){var i=d3.select(this).selectAll("svg").data([n]);c.scale(9.3*o).translate([o/2,l/2]),u.projection(c);var p=i.enter().append("svg").append("g"),f=(p.attr("class","map-collection").selectAll(".map-region").data(t.features,e("id")).enter().append("path").attr("class","map-region").attr("d",u),i.attr("width",o).attr("height",l).selectAll(".map-region").data(n,e("id"))),h=g.domain(),m=h.reduce(function(t,e){return t+e})/h.length,y=g(m);if(r){var x,v=40,b=d3.select("body").append("div").attr("class","election-tooltip").style("opacity",0),k=b.append("div");if(a){void 0!=s.margin&&(v+=s.margin().top+s.margin().bottom),v+=s.height();var w=b.append("figure").style("display","block");v+=7}f.on("mouseover",function(t){k.html(r(t)).select("span.votes").style("color",y),a&&d3.json(a(t),function(t,e){w.datum(e.d).call(s),x=b.node().getBoundingClientRect().height}),b.transition().duration(100).style("opacity",.8)}).on("mousemove",function(){void 0==x&&(x=v),b.style("top",event.pageY-x+"px").style("left",event.pageX+"px")}).on("mouseout",function(){b.transition().duration(100).style("opacity",0)})}f.attr("fill",d).transition().duration(200).attr("fill",function(t){return g(t.votes)}),f.exit().transition().duration(200).attr("fill","black")})}var r,a,o=130,l=2.25*o,i="steelblue",s=demokratikollen.graphics.timeSeriesChart(),c=d3.geo.azimuthalEqualArea().rotate([-17,-62.25]),u=d3.geo.path(),d=d3.rgb("#eee"),p=d3.rgb(i),g=d3.scale.linear().domain([0,1]).range([d,p]);return n.projection=function(t){return arguments.length?(c=t,n):c},n.tooltipTextHtml=function(t){return arguments.length?(r=t,n):r},n.tooltipFigureDataUrl=function(t){return arguments.length?(a=t,n):a},n.tooltipChart=function(t){return arguments.length?(s=t,n):s},n.width=function(t){return arguments.length?(o=t,l=2.25*t,n):o},n.height=function(t){return arguments.length?(l=t,o=t/2.25,n):l},n.colorScale=function(t){return arguments.length?(g=t,n):g},n},demokratikollen.graphics.timeSeriesChart=function(){function t(t){t.each(function(t){var o=d3.select(this).selectAll("svg").data([t]);o.enter().append("svg").attr("width",n+e.left+e.right).attr("height",r+e.top+e.bottom),o=o.selectAll("g").data([t]);var l=o.enter().append("g").attr("transform","translate("+e.left+","+e.top+")");l.append("path").attr("class","line").style("fill","none").style("stroke",a).style("stroke-width","1.5px"),l.append("g").attr("class","x axis"),l.append("g").attr("class","y axis").append("text").attr("class","label"),o.selectAll("g.y.axis").call(c).selectAll("text.label").attr("x",1).attr("dx",".71em").style("text-anchor","start").style("alignment-baseline","middle").text("%"),o.selectAll("g.x.axis").attr("transform","translate(0,"+r+")").call(s),o.selectAll("path.line").data([t]).attr("d",i)})}var e={top:7,right:12,bottom:17,left:25},n=170-e.left-e.right,r=60-e.top-e.bottom,a="steelblue",o=d3.scale.linear().range([0,n]),l=d3.scale.linear().range([r,0]),i=d3.svg.line().x(function(t){return o(t.x)}).y(function(t){return l(t.y)}),s=d3.svg.axis().scale(o).orient("bottom"),c=d3.svg.axis().scale(l).orient("left");return t.width=function(e){return arguments.length?(n=e,t):n},t.height=function(e){return arguments.length?(r=e,t):r},t.margin=function(n){return arguments.length?(e=n,t):e},t.line=function(e){return arguments.length?(i=e,t):i},t.xAxis=function(e){return arguments.length?(s=e,t):s},t.yAxis=function(e){return arguments.length?(c=e,t):c},t.xScale=function(e){return arguments.length?(o=e,t):o},t.yScale=function(e){return arguments.length?(l=e,t):l},t.lineColor=function(e){return arguments.length?(a=e,t):a},t},parties={tooltipFigure:function(){function t(t){t.each(function(t){t.forEach(function(t){t.year=parseInt(t.year),t.votes=+t.votes});var e=d3.extent(t,function(t){return t.year});o.domain(e);var n=d3.extent(t,function(t){return t.votes});l.domain(n),e.splice(1,0,d3.median(t,function(t){return t.year})),i.tickValues(e),s.tickValues(n),s.tickFormat(function(t){return t>=.1?d3.format(".0f")(100*t):d3.format(".1f")(100*t).replace(".",",")}),i.tickFormat(d3.format(".0f"))}),a(t)}var e={top:12,right:12,bottom:17,left:25},n=170-e.left-e.right,r=60-e.top-e.bottom,a=demokratikollen.graphics.timeSeriesChart().lineColor(parties.pColorMild).width(n).height(r).margin(e),o=a.xScale().range([0,n]),l=a.yScale().range([r,0]),i=a.xAxis(),s=a.yAxis(),c=d3.svg.line().x(function(t){return o(t.year)}).y(function(t){return l(t.votes)});return a.line(c),t.width=function(e){return arguments.length?(n=e,t):n},t.height=function(e){return arguments.length?(r=e,t):r},t.margin=function(n){return arguments.length?(e=n,t):e},t},setup:function(t,e,n,r){parties.voterSupportGenderChart=demokratikollen.graphics.horizontalBarChart().width(300).height(100),parties.voterSupportEducationChart=demokratikollen.graphics.horizontalBarChart().width(300).height(200),parties.party=n,parties.year=r,parties.pColor=demokratikollen.utils.parties.get(n).color,parties.pColorMild=d3.interpolateRgb(d3.rgb("#eee"),parties.pColor)(.5);var a=d3.rgb("#eee"),o=d3.rgb(parties.pColor),l=e.max_municipality,i=d3.scale.linear().domain([0,l]).range([a,o]);d3.json("/data/municipalities.topojson",function(a,o){var l=topojson.feature(o,o.objects.municipalities),s=d3.map(l.features,function(t){return t.id}),c=demokratikollen.graphics.mapChart(l).width(150).tooltipTextHtml(function(t){return"<strong>"+s.get(t.id).properties.name+":</strong> <span class='votes'>"+d3.format(".1f")(100*t.votes)+"</span> % "+r}).tooltipFigureDataUrl(function(t){return"/data/elections/timeseries/"+n+"/"+t.id+".json"}).tooltipChart(parties.tooltipFigure()).colorScale(i),u=d3.select(t);parties.updateMap=function(t){u.datum(t.municipalities).call(c)},parties.updateMap(e)})}},Search={Setup:function(){$("#main-search input").on("focusin",function(){$("#main-search").addClass("open")}),$("#main-search input").on("focusout",function(){$("#main-search").removeClass("open")});var t,e={minChars:2};$.getJSON("/data/parliament/members_search.json",function(e){t=new Fuse(e.d,{keys:["fullName","party","groups"],threshold:.6})}),$("#main-search input").on("input",function(t){t.target.value.length>=e.minChars&&(console.log(t),$("#main-search .dropdown-menu").addClass("open"),$("#test").html(t.target.value))})}},demokratikollen.graphics.stackedBarChart=function(){function t(t){t.each(function(t){function c(e){var n=t.bars[e];null!=s&&d3.select(D[0][s]).style("fill-opacity",""),d3.select(D[0][e]).style("fill-opacity",.3),i&&i(n,e),s=e}function u(e){t.bars[e];null!=s&&d3.select(D[0][s]).style("fill-opacity",""),s=null}t.bars.forEach(function(t,e){t.total=d3.sum(t,prop("value")),t.rectData=[],t.forEach(function(n,r){var a={};a.y0=0==r?0:t.rectData[r-1].y1,a.y1=a.y0+n.value,a.x=e,a.color=n.color,a.title=n.title,t.rectData.push(a)})});var d=d3.select(this),p=d.selectAll("g").data([0]);p.enter().append("g").attr("transform","translate("+a.left+","+a.top+")");var g=Math.min(e,l*t.labels.length)-a.left-a.right,f=n-a.top-a.bottom,h=o*g/t.labels.length,m=d3.scale.ordinal().domain(d3.range(t.labels.length)).rangeBands([0,g]),y=d3.svg.axis().scale(m).tickFormat(function(e){return t.labels[e]}).orient("bottom"),x=p.selectAll(".x-axis").data([0]);x.enter().append("g").attr("class","axis x-axis"),x.attr("transform","translate(0,"+f+")").call(y).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-75)");var v=p.selectAll(".title-text").data([0]);v.enter().append("text").attr("class","title-text"),v.text(r).style("text-anchor","middle").attr("x",g/2).attr("y",-a.top).attr("dy","1.5em");var b=d3.max(t.bars,prop("total")),k=d3.scale.linear().domain([0,b]).range([f,0]),w=p.selectAll(".bar-group").data(t.bars);w.enter().append("g").attr("class","bar-group").append("text").attr("class","bar-text"),w.exit().remove();var A=w.selectAll(".bar-rect").data(prop("rectData"),function(t){return t.title});A.enter().append("rect").attr("class","bar-rect"),A.attr("x",function(t){return m(t.x)+.5*(m(1)-h)}).attr("y",function(t){return k(t.y1)}).attr("height",function(t){return k(t.y0)-k(t.y1)}).attr("width",h).style("fill",prop("color")),A.exit().style("fill-opacity",1e-5).remove();var C=w.select(".bar-text");C.text(prop("total")).style("text-anchor","middle").attr("x",function(t,e){return m(e)+.5*m(1)}).attr("y",function(t){return k(t.total)}).attr("dy","-0.1em");var D=p.selectAll(".click-rect").data(t.bars);D.enter().append("rect").attr("class","click-rect"),D.attr("x",function(t,e){return m(e)}).attr("y",k(b)).attr("width",m(1)).attr("height",f+a.bottom).on("mouseover",function(t,e){s!=e&&d3.select(this).style("fill-opacity",.2)}).on("mouseout",function(t,e){s!=e&&d3.select(this).style("fill-opacity","")}).on("click",function(t,e){s!=e&&(u(s),c(e))}),null!=s&&c(s)})}var e=400,n=200,r="",a={top:25,right:10,bottom:60,left:10},o=.6,l=50,i=null,s=null;return t.onBarActivated=function(e){return arguments.length?(i=e,t):i},t.width=function(n){return arguments.length?(e=+n,t):e},t.height=function(e){return arguments.length?(n=+e,t):n},t.bottomMargin=function(e){return arguments.length?(a.bottom=+e,t):a.bottom},t.maxAbsoluteBandWidth=function(e){return arguments.length?(l=+e,t):l},t.currentlyActive=function(e){return arguments.length?(s=e,t):s},t.title=function(e){return arguments.length?(r=e,t):r},t},demokratikollen.graphics.verticalOrdinalLineChart=function(){function t(t){t.each(function(t){t.series.forEach(function(t){t.markerData=t.values.map(function(e,n){return{x:e,y:n,color:t.color}}).filter(function(t){return null!=t.x})});var a=d3.select(this),l=a.selectAll("g").data([0]);l.enter().append("g").attr("transform","translate("+e.left+","+e.top+")");var i=n-e.left-e.right,s=r-e.top-e.bottom,c=d3.scale.ordinal().domain(d3.range(t.labels.length)).rangePoints([s,0]),u=d3.scale.linear().domain([-1.1,1.1]).range([0,i]),d=d3.svg.axis().scale(c).tickFormat(function(e){return t.labels[e]}).orient("left"),p=d3.svg.line().x(function(t){return u(t)}).y(function(t,e){return c(e)}).defined(function(t){return null!=t}),g=l.selectAll(".y-axis").data([0]);g.enter().append("g").attr("class","axis y-axis"),g.call(d),g.exit().remove();var f=l.selectAll(".series-group").data(t.series,prop("title"));f.enter().append("g").attr("class","series-group"),f.exit().style("opacity",1e-5).remove();var h=f.selectAll(".line-path").data(function(t){return[t]});h.enter().append("path").attr("class","line-path"),h.style("stroke",prop("color")).attr("d",function(t){return p(t.values)}),h.exit().style("opacity",1e-5).remove();var m=f.selectAll(".line-marker").data(function(t){return t.markerData});m.enter().append("circle").attr("class","line-marker"),m.attr("cy",compose(c,prop("y"))).attr("cx",compose(u,prop("x"))).attr("r",.5*o).style("stroke",prop("color")),m.exit().style("opacity",1e-5).remove()})}var e={top:25,right:20,bottom:25,left:60},n=400,r=200,a=null,o=8;return t.onLineActivated=function(e){return arguments.length?(a=e,t):a},t.width=function(e){return arguments.length?(n=e,t):n},t.height=function(e){return arguments.length?(r=e,t):r},t.title=function(e){return arguments.length?(title=e,t):title},t};
//# sourceMappingURL=../js/scripts.min.js.map