function prop(t){return function(e){return e[t]}}function compose(t,e){return function(r){return t(e(r))}}demokratikollen={},demokratikollen.utils={},demokratikollen.graphics={},$(function(){if(!$.cookie("cookieconsent")){var t=$("cookienotice");t.fadeIn(2e3),$("#cookie-consent-button").on("click",function(){t.fadeOut(),$.cookie("cookieconsent","true",{expires:365,path:"/"})})}}),function(t,e,r,n,a,o,i){t.GoogleAnalyticsObject=a,t[a]=t[a]||function(){(t[a].q=t[a].q||[]).push(arguments)},t[a].l=1*new Date,o=e.createElement(r),i=e.getElementsByTagName(r)[0],o.async=1,o.src=n,i.parentNode.insertBefore(o,i)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-58748015-1","auto"),ga("send","pageview"),function(t){t.parties=d3.map([{key:"v",color:"#af0000"},{key:"fi",color:"#d9308e"},{key:"pp",color:"#572b85"},{key:"s",color:"#ee2020"},{key:"mp",color:"#83cf39"},{key:"sd",color:"#dddd00"},{key:"nyd",color:"#dddd00"},{key:"-",color:"#bbbbbb"},{key:"c",color:"#009933"},{key:"m",color:"#1b49dd"},{key:"fp",color:"#6bb7ec"},{key:"kd",color:"#231977"}],function(t){return t.key}),t.colors=d3.map([{key:"green",color:"#4cd42f"},{key:"yellow",color:"#ebeb2b"},{key:"red",color:"#cb1310"}],function(t){return t.key}),t.parties.forEach(function(e,r){t.colors.set(e,{key:r.key,color:r.color})}),t.getPartyColor=function(t){return d3.rgb(demokratikollen.utils.colors.get(t.toLowerCase()).color)},t.getInnerWidth=function(t){var e=window.getComputedStyle(t.node());return parseInt(e.width)-parseInt(e.paddingLeft)-parseInt(e.paddingRight)},t.sv_SE={decimal:",",thousands:" ",grouping:[3],currency:[""," kr"],dateTime:"%A %e %B %Y %X",date:"%Y-%m%-%d",time:"%H:%M:%S",periods:["AM","PM"],days:["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],shortDays:["sön","mån","tis","ons","tor","fre","lö"],months:["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],shortMonths:["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"]},t.locale=d3.locale(t.sv_SE),t.pageState=function(t){var e={},r={},n={};for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a].defaultValue,r[a]=t[a].urlName,n[t[a].urlName]=a);if(location.hash.length>1){var o=location.hash.substr(1).split("&");o.forEach(function(t){var r=t.split("="),a=r[0];if(!n.hasOwnProperty(a))return void console.warn("Undefined urlName in pageState: ",a);var o=decodeURIComponent(r[1]);""==o&&(o=null);var i=parseInt(o,10);isNaN(i)||(o=i),e[n[a]]=o})}return function(t){if(t.length){var n=t;return e.hasOwnProperty(n)?e[n]:console.warn("Unknown state key: ",t)}for(var n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)&&(e[n]=t[n]);var a=[];for(var n in e)e.hasOwnProperty(n)&&a.push(r[n]+"="+encodeURIComponent(e[n]));var o=a.join("&");location.hash="#"+o}},t.uniqueId=function(){var t=0;return function(e){return e||(e=""),e+"-unique-"+t}}()}(demokratikollen.utils),demokratikollen.graphics.AppointmentsTimeline=function(){function t(t){return d3.min(t,function(t){return t.startDate})}function e(t){return d3.max(t,function(t){return t.endDate})}function r(r,n){var a=[e(r.values),e(n.values)];return a[0]!==a[1]?a[1]-a[0]:t(n.values)-t(r.values)}function n(t){return t.reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[])}function a(a){a.each(function(a){var g=d3.nest().key(function(t){return t.rowLabel}).entries(a);g.sort(r);var m=g.map(function(t){return t.key}),y=t(a),v=e(a),x=demokratikollen.utils.getInnerWidth(d3.select(this))-l.left-l.right,b=m.length*o,k=d3.select(this),w=k.append("svg").classed(f,!0).attr("width",x+l.left+l.right).attr("height",b+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")");w.append("rect").attr("width",x).attr("height",b).classed("background",!0);var A=d3.time.scale().domain([y,v]).range([0,x]).nice(c),C=d3.scale.ordinal().domain(m).rangePoints([0,b],1),D=A.ticks(Math.floor(x/u));D=n(D.map(c.floor));var M=d3.svg.axis().scale(A).orient("top").tickSize(-b,0).tickValues(D);M=w.append("g").classed("axis x",!0).call(M),M.selectAll("text").style("text-anchor","start"),w.append("g").classed("rowLabels",!0).selectAll("rowLabels").data(m).enter().append("text").text(function(t){return t}).attr("transform",function(t){return"translate("+s+","+C(t)+")"});var S=d3.svg.line().x(function(t){return A(t[0])}).y(function(t){return C(t[1])}),j=w.append("g").attr("transform","translate(0,"+i+")").classed("lines",!0).selectAll("lines").data(a).enter();if(j.append("path").attr("d",function(t){return S([[t.startDate,t.rowLabel],[t.endDate,t.rowLabel]])}).attr("class",function(t){return t.cssClass||""}),j.append("circle").attr("cx",function(t){return A(t.startDate)}).attr("cy",function(t){return C(t.rowLabel)}).attr("r",p),j.append("circle").attr("cx",function(t){return A(t.endDate)}).attr("cy",function(t){return C(t.rowLabel)}).attr("r",p),d){var P=d3.select("body").append("div").classed(f+" tooltip",!0).style("display","none").style("position","absolute").style("max-width",x+"px"),_=function(t,e){P.style("left",t+"px").style("top",e+"px")},L=function(){P.style("display","none")},I=function(t){P.style("display","block"),P.html(d(t)),_(0,0);var e=d3.mouse(d3.select("body")[0][0]),r=e[0],n=e[1],a=P[0][0].getBoundingClientRect(),i=a.right-a.left,l=w[0][0].getBoundingClientRect(),s={left:window.pageXOffset+l.left,right:window.pageXOffset+l.left+x};r+i/2>s.right?r=s.right-i/2:r-i/2<s.left&&(r=s.left+i/2),_(r-i/2,n+o/2)};j.append("path").style("stroke","rgba(0,0,0,0)").style("stroke-width",h).attr("d",function(t){return S([[t.startDate,t.rowLabel],[t.endDate,t.rowLabel]])}).on("mouseover",I).on("mouseout",function(){L()})}})}var o=40,i=10,l={top:20,right:0,bottom:5,left:0},s=10,c=d3.time.year,u=100,d=null,p=4,f="timeline",h=o-15;return a.tipHtml=function(t){return arguments.length?(d=t,a):d},a.timeUnit=function(t){return arguments.length?(c=t,a):c},a.tickLabelWidth=function(t){return arguments.length?(u=t,a):u},a},demokratikollen.graphics.horizontalBarChart=function(){function t(t){t.each(function(t){var l=d3.select(this),c=l.selectAll("g").data([0]);c.enter().append("g").attr("transform","translate("+r.left+","+r.top+")");var u=a-r.left-r.right,d=Math.min(o,i*t.length)-r.top-r.bottom,p=n*d/t.length,f=d3.scale.ordinal().domain(d3.range(t.length)).rangeBands([d,0]),h=d3.max(t,prop("value")),g=d3.scale.linear().domain([0,h]).range([0,u]),m=c.selectAll(".title-text").data([0]);m.enter().append("text").attr("class","title-text"),m.text(e).style("text-anchor","middle").attr("x",u/2).attr("y",-r.top).attr("dy","1.5em");var y=c.selectAll(".bar-rect").data(t,prop("title"));y.enter().append("rect").attr("class","bar-rect"),y.attr("y",function(e,r){return f(r)+.5*d/t.length}).attr("x",0).attr("width",function(t){return g(t.value)}).attr("height",p).style("fill",prop("color")),y.exit().style("fill-opacity",1e-5).remove(),barTexts=c.selectAll(".bar-text").data(t,prop("title")),barTexts.enter().append("text").attr("class","bar-text"),barTexts.text(s).style("text-anchor","start").style("alignment-baseline","middle").attr("x",function(t){return g(t.value)}).attr("dx","0.4em").attr("dy","0.1em").attr("y",function(e,r){return f(r)+.5*d/t.length+.5*p}),barTexts.exit().remove(),barTitles=c.selectAll(".bar-title").data(t,prop("title")),barTitles.enter().append("text").attr("class","bar-title"),barTitles.text(function(t){return t.title}).attr("x",0).attr("dy","-0.2em").attr("y",function(e,r){return f(r)+.5*d/t.length}),barTitles.exit().remove()})}var e="",r={top:40,right:50,bottom:0,left:0},n=.4,a=400,o=200,i=40,l=null,s=function(t){return t.value};return t.onBarActivated=function(e){return arguments.length?(l=e,t):l},t.width=function(e){return arguments.length?(a=e,t):a},t.height=function(e){return arguments.length?(o=e,t):o},t.topMargin=function(e){return arguments.length?(r.top=e,t):r.top},t.maxAbsoluteBandWidth=function(e){return arguments.length?(i=e,t):i},t.title=function(r){return arguments.length?(e=r,t):e},t.formatter=function(e){return arguments.length?(s=e,t):s},t},demokratikollen.graphics.dateMemberCollectionFigure={Setup:function(t,e,r,n,a){$(t).append("<svg id='member_collection' viewBox='0 0 940 470' preserveAspectRatio='xMinYMin meet'>"),d3.select("body").on("click",function(){"member-node-tooltip"!==d3.event.target.parentNode.parentNode.className&&d3.select("div.member-node-tooltip").style("display","none")});var o=new Date,i=o.getTime(),l=$(e).slider({value:i,min:a.minDate,max:i,step:a.dateTick,change:function(){var t=a;t.UpdateFromDateSlider(t)}});l.slider("pips",{rest:"label",step:8,formatLabel:function(t){return o=new Date,o.setTime(t),o.toISOString().slice(0,4)}}),l.slider("float",{formatLabel:function(t){return o=new Date,o.setTime(t),o.toISOString().slice(0,4)}});var s=d3.select("body").append("div").attr("class","member-node-tooltip").style("display","none"),c=s.append("a");return c.append("img"),c.append("p"),d3.select("svg#member_collection")},DrawMemberNodes:function(t){var e=demokratikollen.graphics.dateMemberCollectionFigure,r=d3.select("svg#member_collection"),n=r.selectAll("a.member_node").data(t,function(t){return t.member_id});n.exit().remove();var a=n.enter().append("a").attr("xlink:href",function(t){return"/"+t.url_name}).attr("transform",function(t){return"translate("+t.x+","+4*-t.r+")"}).classed({member_node:!0,taphover:!0});a.append("circle").style("fill",function(t){return demokratikollen.utils.getPartyColor(t.party).toString()}).attr("r",function(t){return t.r});var o=function(t){d3.select("div.member-node-tooltip").style("display",""),d3.select("div.member-node-tooltip p").text(t.name),d3.select("div.member-node-tooltip img").attr("src",""),d3.select("div.member-node-tooltip a").attr("href","/"+t.url_name)},i=function(t,e,r){{var n=20;d3.select("div.member-node-tooltip").style("top",r+n+"px").style("left",e+"px")}d3.select("div.member-node-tooltip img").attr("src",t.image_url)},l=function(){d3.select("div.member-node-tooltip").style("display","none"),d3.select("a.hover").classed({hover:!1})},s=function(t){d3.event.preventDefault();var e=d3.event.targetTouches[0].pageX,r=d3.event.targetTouches[0].pageY;return o(t),i(t,e,r),d3.select(this).classed({hover:!0}),!1};a.on("mouseover",o),a.on("mousemove",function(t){i(t,d3.event.pageX,d3.event.pageY)}),a.on("mouseout",l),a.on("touchstart",s);var c=!1;if(c){var u=e.slowBrowser?n:n.transition().duration(1e3);u.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}else{n.attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),a.style("opacity",0);var u=e.slowBrowser?n:n.transition().duration(1e3);u.style("opacity",1)}},slowBrowser:!1},parliamentChairs={Setup:function(){this.canvas=demokratikollen.graphics.dateMemberCollectionFigure.Setup("div#parliament-figure figure.canvas","div#parliament-date-slider div.date_slider",940,470,this),this.UpdateFromDateSlider(this)},UpdateFromDateSlider:function(t){var e=$("div#parliament-date-slider div.date_slider").slider("value"),r=new Date;r.setTime(e),t.date_string=r.toISOString().slice(0,10),t.FetchData()},FetchData:function(){var t=this;d3.json(this.dataUrl+"?date="+this.date_string,function(e,r){t.ParseData(r.data)})},ParseData:function(t){this.CalculatePartySupport(t),this.GeneratePositions(t),demokratikollen.graphics.dateMemberCollectionFigure.DrawMemberNodes(t);var e=this.GetPartyAngles(t);this.DrawPartySymbols(e)},CalculatePartySupport:function(t){var e=(t.length,{});for(key in demokratikollen.utils.parties._){var r=t.filter(function(t){return t.party.toLowerCase()==key});r.length>0&&(e[key]=r.length)}this.partySupport=e},DrawPartySymbols:function(t){var e=this,r=this.max_width/2,n=this.max_height,a=this.max_width/2-50,o=this.canvas.selectAll("g.decoration").data(t,function(t){return t.party}),i=function(t){var e=-500,n=r+a*Math.cos(t.angle);return"translate("+n+","+e+")"};o.exit().transition().duration(1e3).attr("transform",i).remove();var l=o.enter().append("g").attr("class","decoration");l.append("text").text(function(t){return e.partySupport[t.party]}).attr("class","party_support").attr("text-anchor","middle").attr("y",35).attr("font-size","32px"),l.append("text").attr("class","party_abbr").text(function(t){return t.party.toUpperCase()}).attr("text-anchor","middle").attr("font-size","45px"),l.attr("transform",i),o.transition().duration(1e3).attr("transform",function(t){var e=n-a*Math.sin(t.angle),o=r+a*Math.cos(t.angle);return"translate("+o+","+e+"),rotate("+180*(-t.angle+Math.PI/2)/Math.PI+")"}),o.filter(function(t){return e.partySupport[t.party]<12?!0:!1}).transition().duration(1e3).attr("transform",i)},GetPartyAngles:function(t){var e=this.max_width/2,r=this.max_height,n=[];for(key in demokratikollen.utils.parties._){var a=t.filter(function(t){return t.party.toLowerCase()==key});if(a.length>0&&"-"!=key){var o=a.reduce(function(t,n){var a=n.x-e,o=r-n.y,i=Math.atan(o/a);return 0>a&&(i+=Math.PI),t+i},0)/a.length;n.push({party:key,angle:o})}}return n},GeneratePositions:function(t){for(var e=10,r=e-1,n=this.chairs_inner_radius,a=5,o=(r*r+r)/2,i=t.length,l=this.max_width/2,s=this.max_height,c=(Math.PI*e*n+a*(Math.PI*o-(i-1)))/(2*i-2*Math.PI*o),u=[],d=0;e>d;d++){var p=n+d*(a+2*c),f=Math.round(Math.PI*p/(a+2*c));u.push({r:p,n:f})}for(var h=0,d=0;d<u.length;d++)h+=u[d].n;h>i&&u[e-1].n--,i>h&&u[e-1].n++;for(var g=[],d=0;e>d;d++)g.push(0);for(var d=0;i>d;d++){for(var m=[],y=0,v=100,x=0;e>x;x++)m.push(Math.PI*(g[x]/(u[x].n-1))),m[x]<v&&(y=x,v=m[x]);var b=-u[y].r*Math.cos(v),k=-u[y].r*Math.sin(v);g[y]++,t[d].x=l+b,t[d].y=s+k,t[d].r=c}},canvas:null,partySupport:null,dataUrl:"/data/parliament/parliament.json",date_string:null,minDate:512761189e3,dateTick:31536e6,chairs_inner_radius:150,max_width:940,max_height:455},demokratikollen.graphics.mapChart=function(t){function e(t){return function(e){return e[t]}}function r(r){r.each(function(r){var l=d3.select(this).selectAll("svg").data([r]);c.scale(9.3*o).translate([o/2,i/2]),u.projection(c);var p=l.enter().append("svg").append("g"),h=(p.attr("class","map-collection").selectAll(".map-region").data(t.features,e("id")).enter().append("path").attr("class","map-region").attr("d",u),l.attr("width",o).attr("height",i).selectAll(".map-region").data(r,e("id"))),g=f.domain(),m=g.reduce(function(t,e){return t+e})/g.length,y=f(m);if(n){var v,x=40,b=d3.select("body").append("div").attr("class","election-tooltip").style("opacity",0),k=b.append("div");if(a){void 0!=s.margin&&(x+=s.margin().top+s.margin().bottom),x+=s.height();var w=b.append("figure").style("display","block");x+=7}h.on("mouseover",function(t){k.html(n(t)).select("span.votes").style("color",y),a&&d3.json(a(t),function(t,e){w.datum(e.d).call(s),v=b.node().getBoundingClientRect().height}),b.transition().duration(100).style("opacity",.8)}).on("mousemove",function(){void 0==v&&(v=x),b.style("top",d3.event.pageY-v+"px").style("left",d3.event.pageX+"px")}).on("mouseout",function(){b.transition().duration(100).style("opacity",0)})}h.attr("fill",d).transition().duration(200).attr("fill",function(t){return f(t.votes)}),h.exit().transition().duration(200).attr("fill","black")})}var n,a,o=130,i=2.25*o,l="steelblue",s=demokratikollen.graphics.timeSeriesChart(),c=d3.geo.azimuthalEqualArea().rotate([-17,-62.25]),u=d3.geo.path(),d=d3.rgb("#eee"),p=d3.rgb(l),f=d3.scale.linear().domain([0,1]).range([d,p]);return r.projection=function(t){return arguments.length?(c=t,r):c},r.tooltipTextHtml=function(t){return arguments.length?(n=t,r):n},r.tooltipFigureDataUrl=function(t){return arguments.length?(a=t,r):a},r.tooltipChart=function(t){return arguments.length?(s=t,r):s},r.width=function(t){return arguments.length?(o=t,i=2.25*t,r):o},r.height=function(t){return arguments.length?(i=t,o=t/2.25,r):i},r.colorScale=function(t){return arguments.length?(f=t,r):f},r},demokratikollen.graphics.timeSeriesChart=function(){function t(t){t.each(function(t){var o=d3.select(this).selectAll("svg").data([t]);o.enter().append("svg").attr("width",r+e.left+e.right).attr("height",n+e.top+e.bottom),o=o.selectAll("g").data([t]);var i=o.enter().append("g").attr("transform","translate("+e.left+","+e.top+")");i.append("path").attr("class","line").style("fill","none").style("stroke",a).style("stroke-width","1.5px"),i.append("g").attr("class","x axis"),i.append("g").attr("class","y axis").append("text").attr("class","label"),o.selectAll("g.y.axis").call(c).selectAll("text.label").attr("x",1).attr("dx",".71em").style("text-anchor","start").style("alignment-baseline","middle").text("%"),o.selectAll("g.x.axis").attr("transform","translate(0,"+n+")").call(s),o.selectAll("path.line").data([t]).attr("d",l)})}var e={top:7,right:12,bottom:17,left:25},r=170-e.left-e.right,n=60-e.top-e.bottom,a="steelblue",o=d3.scale.linear().range([0,r]),i=d3.scale.linear().range([n,0]),l=d3.svg.line().x(function(t){return o(t.x)}).y(function(t){return i(t.y)}),s=d3.svg.axis().scale(o).orient("bottom"),c=d3.svg.axis().scale(i).orient("left");return t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(n=e,t):n},t.margin=function(r){return arguments.length?(e=r,t):e},t.line=function(e){return arguments.length?(l=e,t):l},t.xAxis=function(e){return arguments.length?(s=e,t):s},t.yAxis=function(e){return arguments.length?(c=e,t):c},t.xScale=function(e){return arguments.length?(o=e,t):o},t.yScale=function(e){return arguments.length?(i=e,t):i},t.lineColor=function(e){return arguments.length?(a=e,t):a},t},parties={tooltipFigure:function(){function t(t){t.each(function(t){t.forEach(function(t){t.year=parseInt(t.year),t.votes=+t.votes});var e=d3.extent(t,function(t){return t.year});o.domain(e);var r=[0,d3.max(t,function(t){return t.votes})];i.domain(r),e.splice(1,0,d3.median(t,function(t){return t.year})),l.tickValues(e),s.tickValues(r),s.tickFormat(function(t){return t>=.1?d3.format(".0f")(100*t):d3.format(".1f")(100*t).replace(".",",")}),l.tickFormat(d3.format(".0f"))}),a(t)}var e={top:12,right:12,bottom:17,left:25},r=170-e.left-e.right,n=60-e.top-e.bottom,a=demokratikollen.graphics.timeSeriesChart().lineColor(parties.pColorMild).width(r).height(n).margin(e),o=a.xScale().range([0,r]),i=a.yScale().range([n,0]),l=a.xAxis(),s=a.yAxis(),c=d3.svg.line().x(function(t){return o(t.year)}).y(function(t){return i(t.votes)});return a.line(c),t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(n=e,t):n},t.margin=function(r){return arguments.length?(e=r,t):e},t},setupGenderChart:function(t,e){parties.voterSupportGenderChart=demokratikollen.graphics.horizontalBarChart().formatter(function(t){return t.value+"%"}).width(t).height(e).topMargin(0)},setupEducationChart:function(t,e){parties.voterSupportEducationChart=demokratikollen.graphics.horizontalBarChart().formatter(function(t){return t.value+"%"}).width(t).height(e).topMargin(0)},setup:function(t,e,r,n){parties.party=r,parties.year=n,parties.pColor=demokratikollen.utils.parties.get(r).color,parties.pColorMild=d3.interpolateRgb(d3.rgb("#eee"),parties.pColor)(.5);var a=d3.rgb("#eee"),o=d3.rgb(parties.pColor).darker(.5),i=e.max_municipality,l=d3.scale.linear().domain([0,i]).range([a,o]);d3.json("/data/municipalities.topojson",function(a,o){var i=topojson.feature(o,o.objects.municipalities),s=d3.map(i.features,function(t){return t.id}),c=demokratikollen.graphics.mapChart(i).width(250).tooltipTextHtml(function(t){return"<strong>"+s.get(t.id).properties.name+":</strong> <span class='votes'>"+d3.format(".1f")(100*t.votes)+"</span> % "+n}).tooltipFigureDataUrl(function(t){return"/data/elections/timeseries/"+r+"/"+t.id+".json"}).tooltipChart(parties.tooltipFigure()).colorScale(l),u=d3.select(t);parties.updateMap=function(t){u.datum(t.municipalities).call(c)},parties.updateMap(e)})}},demokratikollen.graphics.PartyHistory=function(){function t(t){return t.reduce(function(t,e){return t.indexOf(e)<0&&t.push(e),t},[])}function e(e){e.each(function(e){function u(t){P.style("display",t?"block":"none")}function d(t,e){P.style("left",t+"px").style("top",e+"px")}function p(t){var e=b[0][0].getBoundingClientRect(),r={left:window.pageXOffset+e.left,right:window.pageXOffset+e.left+g,top:window.pageYOffset+e.top+m+50},n=r.left+C(t);d(r.left,r.top);var a=P[0][0].getBoundingClientRect(),o=a.right-a.left;n-o/2<r.left?d(r.left,r.top):n+o/2>r.right?d(r.right-o):d(n-o/2,r.top)}function f(){var t=[];S.selectAll("rect.election").data(e.elections).enter().append("rect").classed("election",!0).attr("y",function(t){return D(t.value)}).attr("x",function(t){return Math.floor(C(t.start))}).attr("width",function(t){return Math.ceil(C(t.end))-Math.floor(C(t.start))}).attr("height",function(t){return D(0)-D(t.value)});var r=k.selectAll("rect.party-leader").data(e.partyLeaders);r.enter().append("rect").classed("party-leader",!0).attr("clip-path","url(#"+M+")").attr("y",0).attr("x",function(t){return C(t.start)}).attr("width",function(t){return C(t.end)-C(t.start)}).attr("height",m),t.push({text:"Partiledare",draw:function(t){var e=[{x:5,y:3,height:14,width:15},{x:20,y:3,height:14,width:15}];t.selectAll("rect.party-leader").data(e).enter().append("rect").classed("party-leader",!0).attr("y",prop("y")).attr("x",prop("x")).attr("width",prop("width")).attr("height",prop("height")).style("fill",c.darker(3)).style("fill-opacity",function(t,e){return t.selected?.7:e%2!==0?.4:.5})}}),r.classed("selected",prop("selected")).style("fill",function(t){return c.darker(t.selected?1:3)}).style("fill-opacity",function(t,e){return t.selected?.7:e%2!==0?.4:.5});var n=k.selectAll("line.election").data(e.elections);n.enter().append("line").classed("election",!0).attr("x1",function(t){return C(t.start)}).attr("x2",function(t){return C(t.end)}).attr("y1",function(t){return D(t.value)}).attr("y2",function(t){return D(t.value)}),n.classed("selected",prop("selected")).style("stroke",function(t){return c.darker(t.selected?.5:3)}),t.push({text:"Valresultat",draw:function(t){t.append("line").attr("x1",5).attr("x2",35).attr("y1",10).attr("y2",10).style("stroke",c.darker(3)).classed("election",!0)}});var a=c.darker(2);k.selectAll("path.poll").data([e.polls]).enter().append("path").classed("poll",!0).attr("d",j).style("stroke",a).style("fill","none");var o=k.selectAll("circle.poll").data(e.polls);if(o.enter().append("circle").classed("poll",!0).attr("cx",function(t){return C(t.time)}).attr("cy",function(t){return D(t.value)}).attr("r",l).style("fill",a).style("stroke",a),o.classed("selected",prop("selected")),t.push({text:"Opinionsläge",draw:function(t){var e=[[10,10],[30,10]];t.append("path").datum(e).classed("poll",!0).attr("d",d3.svg.line()).style("stroke",a).style("fill","none"),t.selectAll("circle.poll").data(e).enter().append("circle").classed("poll",!0).attr("cx",function(t){return t[0]}).attr("cy",function(t){return t[1]}).attr("r",l).style("fill",a).style("stroke",a)}}),y.selectAll("li").data(t).enter().append("li").each(function(t){var e=d3.select(this);e.append("svg").attr("width",40).attr("height",20).call(t.draw),e.append("span").text(t.text)}),e.texts){var i=P.selectAll("p").data(e.texts);i.enter().append("p"),i.html(function(t){return t})}u(!!e.texts)}e.partyLeaders.forEach(function(t){if(void 0===t.end){var e=new Date,r=new Date(e);r.setDate(e.getDate()+1),t.end=r,t.ongoing=!0}});var h=d3.select(this).html("").append("div").classed(s,!0).style("width",r).style("height",n),g=r-a.left-a.right,m=n-a.top-a.bottom,y=h.append("div").classed("legend",!0).style("margin-left",a.left+"px").style("width",g+"px").append("ul"),v=h.append("svg").classed(s,!0).attr("width",r).attr("height",n).append("g").attr("transform","translate("+a.left+","+a.top+")"),x=demokratikollen.utils.uniqueId("plot-area"),b=v.append("clipPath").attr("id",x).append("rect").attr("width",g).attr("height",m).style("fill","transparent"),k=v.append("g").attr("clip-path","url(#"+x+")"),w=[d3.min(e.elections,prop("start")),new Date],A=[0,d3.max(e.elections.concat(e.polls),prop("value"))],C=d3.time.scale().domain(w).range([0,g]),D=d3.scale.linear().domain(A).range([m,0]).nice(),M=demokratikollen.utils.uniqueId("elections"),S=k.append("clipPath").attr("id",M),j=d3.svg.line().x(function(t){return C(t.time)}).y(function(t){return D(t.value)}),P=d3.select("body").selectAll("div.tooltip."+s.split(" ").join(".")).data([0]).enter().append("div").classed(s+" tooltip",!0).style("display","none").style("position","absolute").style("max-width",g+"px"),_=C.ticks(Math.floor(g/i));_=t(_.map(o.floor));var L=d3.svg.axis().scale(C).orient("bottom").tickValues(_),I=d3.svg.axis().scale(D).tickFormat(d3.format(",.1%")).orient("left");v.append("g").classed("axis x",!0).attr("transform","translate(0,"+m+")").call(L),v.append("g").classed("axis y",!0).call(I);var O=function(){function t(t){return function(e){e&&(e.selected=t)}}function r(t){var e=v.selectAll(".vertical-picker").data([C(t)]);e.enter().append("line").style("pointer-events","none").classed("vertical-picker",!0),e.attr("x1",function(t){return t}).attr("x2",function(t){return t}).attr("y1",0).attr("y2",m)}function n(n){r(n);var a=!1,l=o;o=i.map(function(t){return t(n)}),l?l.forEach(t(!1)):l=o.map(function(){return null}),o.forEach(t(!0)),d3.zip(o,l).forEach(function(t){var e=t[0],r=t[1];a=a||e!==r}),a&&(e.texts=d3.zip(o,d).map(function(t){var e=t[0],r=t[1];return r(e)}),f(),p(n))}var a=["partyLeader","election","poll"],o=null,i={partyLeader:function(t){return e.partyLeaders.filter(function(e){return e.start<=t&&t<=e.end})[0]},election:function(t){return e.elections.filter(function(e){return e.start<=t&&t<=e.end})[0]},poll:function(t){return e.polls.filter(function(e){return e.time<=t}).reverse()[0]}};i=a.map(function(t){return i[t]});var l=demokratikollen.utils.locale,s=l.timeFormat("%Y"),c=l.timeFormat("%b %Y"),u=l.numberFormat(",.1%"),d={partyLeader:function(t){return t?"Partiledare: "+t.name+" ("+s(t.start)+" – "+(t.ongoing?"":s(t.end))+")":"Partiledare: okänd"},election:function(t){return t?"Valresultat "+s(t.start)+": "+u(t.value):"Valresultat: okänt"},poll:function(t){return t?"Opinion "+c(t.time)+": "+u(t.value):"Opinion: okänd"}};return d=a.map(function(t){return d[t]}),n}(),E=v.append("rect").attr("width",g).attr("height",m).style("fill","transparent"),B=demokratikollen.utils.uniqueId(s);E.on("mousemove."+B,function(){var t=d3.mouse(this)[0];O(C.invert(t))}),E.on("mouseout."+B,function(){O(new Date)}),O(new Date)})}var r=400,n=350,a={top:20,left:50,right:20,bottom:110},o=d3.time.year,i=100,l=3,s="party-history",c="#555";return e.timeUnit=function(t){return arguments.length?(o=t,e):o},e.xTickLabelWidth=function(t){return arguments.length?(i=t,e):i},e.width=function(t){return arguments.length?(r=t,e):r},e.height=function(t){return arguments.length?(n=t,e):n},e.svgMargin=function(t){return arguments.length?(a=t,e):a},e.cssClass=function(t){return arguments.length?(s=t,e):s},e.baseColor=function(t){return arguments.length?(c=t,e):c},e},function(t){var e,r="/search.json",n="#searchbox";t.initSearch=function(){function t(t){var t=" ".concat(t.trim()," "),e=t.length-i+1,r=d3.map();if(1>e)return r;for(;e--;){var n=t.substr(e,i);r.set(n,r.get(n)+1||1)}return r}var a=d3.select(n),o=d3.map(),i=3,l=.85,s=3;d3.json(r,function(r,n){function i(r){for(var a=c.length-1;a;a--)e[a]=0;var i=t(r.toLowerCase());i.forEach(function(t,r){var n=o.get(t);n&&n.forEach(function(t){var n=t[0],a=t[1];e[n]+=a*r})});var u=d3.max(e),d=e.map(function(t,e){return{keyword:c[e],score:t}}).filter(function(t){return t.score>l*u}).sort(function(t,e){return e.score-t.score});if(!d)return null;var p=d[0].keyword.primary,f={top:n.groups[p[0]].objects[p[1]],groups:n.groups.map(function(t){return{title:t.title,objects:[]}})};return d.some(function(t){var e=t.keyword.primary,r=f.groups[e[0]];return r.objects.length>=s?void 0:(-1==r.objects.indexOf(e[1])&&r.objects.push(e[1]),f.groups.map(function(t){return t.objects.length>=s}).reduce(function(t,e){return t&&e}))}),d.some(function(t){t.keyword.secondaries.forEach(function(t){var e=f.groups[t[0]];if(!(e.objects.length>=s))return-1==e.objects.indexOf(t[1])&&e.objects.push(t[1]),f.groups.map(function(t){return t.objects.length>=s}).reduce(function(t,e){return t&&e})})}),f.groups.forEach(function(t,e){t.objects=t.objects.map(function(t){return n.groups[e].objects[t]})}),f}if(r)return void console.warn(r);var c=n.keywords;e=Array(c.length),n.keywords.forEach(function(e,r){{var n=t(e.string);1/d3.sum(n.values().map(function(t){return t*t}))}n.forEach(function(t,e){o.has(t)||o.set(t,[]),o.get(t).push([r,e])})}),d3.select("#main-search").on("focusout",function(){d3.select(this).classed("open",!1)}).on("focusin",function(){var t=a.property("value");t.length<2||d3.select(this).classed("open",!0)});var u=[];a.on("keydown",function(){13==d3.event.keyCode&&u&&(d3.event.preventDefault(),location.href=u.top.url)}),a.on("keyup",function(){var t=this.value;if(t.length<2)return void d3.select("#main-search").classed("open",!1);u=i(t),d3.select("#main-search").classed("open",!0);var e=d3.select("#searchresults"),r=e.selectAll(".tophit").data([u.top]);r.enter().append("li").attr("class","tophit").attr("role","presentation").append("a"),r.select("a").attr("href",prop("url")).text(prop("title"));var n=e.selectAll(".group").data(u.groups),a=n.enter().append("ul").attr("class","group");a.append("li"),a.append("ul").attr("class","group-items"),n.select("li").text(function(t){return t.title}),n.exit().remove();var o=n.select("ul").selectAll("li").data(function(t){return t.objects});o.enter().append("li").attr("class","group-item").attr("role","presentation").append("a"),o.select("a").attr("href",prop("url")).text(prop("title")),o.exit().remove()})})}}(demokratikollen),demokratikollen.graphics.stackedBarChart=function(){function t(t){t.each(function(t){function c(e){var r=t.bars[e];null!=s&&d3.select(D[0][s]).style("fill-opacity",""),d3.select(D[0][e]).style("fill-opacity",.3),l&&l(r,e),s=e}function u(e){t.bars[e];null!=s&&d3.select(D[0][s]).style("fill-opacity",""),s=null}t.bars.forEach(function(t,e){t.total=d3.sum(t,prop("value")),t.rectData=[],t.forEach(function(r,n){var a={};a.y0=0==n?0:t.rectData[n-1].y1,a.y1=a.y0+r.value,a.x=e,a.color=r.color,a.title=r.title,t.rectData.push(a)})});var d=d3.select(this),p=d.selectAll("g").data([0]);p.enter().append("g").attr("transform","translate("+a.left+","+a.top+")");var f=Math.min(e,i*t.labels.length)-a.left-a.right,h=r-a.top-a.bottom,g=o*f/t.labels.length,m=d3.scale.ordinal().domain(d3.range(t.labels.length)).rangeBands([0,f]),y=d3.svg.axis().scale(m).tickFormat(function(e){return t.labels[e]}).orient("bottom"),v=p.selectAll(".x-axis").data([0]);v.enter().append("g").attr("class","axis x-axis"),v.attr("transform","translate(0,"+h+")").call(y).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-75)");var x=p.selectAll(".title-text").data([0]);x.enter().append("text").attr("class","title-text"),x.text(n).style("text-anchor","middle").attr("x",f/2).attr("y",-a.top).attr("dy","1.5em");var b=d3.max(t.bars,prop("total")),k=d3.scale.linear().domain([0,b]).range([h,0]),w=p.selectAll(".bar-group").data(t.bars);w.enter().append("g").attr("class","bar-group").append("text").attr("class","bar-text"),w.exit().remove();var A=w.selectAll(".bar-rect").data(prop("rectData"),function(t){return t.title});A.enter().append("rect").attr("class","bar-rect"),A.attr("x",function(t){return m(t.x)+.5*(m(1)-g)}).attr("y",function(t){return k(t.y1)}).attr("height",function(t){return k(t.y0)-k(t.y1)}).attr("width",g).style("fill",prop("color")),A.exit().style("fill-opacity",1e-5).remove();var C=w.select(".bar-text");C.text(prop("total")).style("text-anchor","middle").attr("x",function(t,e){return m(e)+.5*m(1)}).attr("y",function(t){return k(t.total)}).attr("dy","-0.1em");var D=p.selectAll(".click-rect").data(t.bars);D.enter().append("rect").attr("class","click-rect"),D.attr("x",function(t,e){return m(e)}).attr("y",k(b)).attr("width",m(1)).attr("height",h+a.bottom).on("mouseover",function(t,e){s!=e&&d3.select(this).style("fill-opacity",.2)
}).on("mouseout",function(t,e){s!=e&&d3.select(this).style("fill-opacity","")}).on("click",function(t,e){s!=e&&(u(s),c(e))}),null!=s&&c(s)})}var e=400,r=200,n="",a={top:25,right:10,bottom:60,left:10},o=.6,i=50,l=null,s=null;return t.onBarActivated=function(e){return arguments.length?(l=e,t):l},t.width=function(r){return arguments.length?(e=+r,t):e},t.height=function(e){return arguments.length?(r=+e,t):r},t.bottomMargin=function(e){return arguments.length?(a.bottom=+e,t):a.bottom},t.maxAbsoluteBandWidth=function(e){return arguments.length?(i=+e,t):i},t.currentlyActive=function(e){return arguments.length?(s=e,t):s},t.title=function(e){return arguments.length?(n=e,t):n},t},demokratikollen.graphics.verticalOrdinalLineChart=function(){function t(t){t.each(function(t){t.series.forEach(function(t){t.markerData=t.values.map(function(e,r){return{x:e,y:r,color:t.color}}).filter(function(t){return null!=t.x})});var a=d3.select(this),i=a.selectAll("g").data([0]);i.enter().append("g").attr("transform","translate("+e.left+","+e.top+")");var l=r-e.left-e.right,s=n-e.top-e.bottom,c=d3.scale.ordinal().domain(d3.range(t.labels.length)).rangePoints([s,0]),u=d3.scale.linear().domain([-1.1,1.1]).range([0,l]),d=d3.svg.axis().scale(c).tickFormat(function(e){return t.labels[e]}).orient("left"),p=d3.svg.line().x(function(t){return u(t)}).y(function(t,e){return c(e)}).defined(function(t){return null!=t}),f=i.selectAll(".y-axis").data([0]);f.enter().append("g").attr("class","axis y-axis"),f.call(d),f.exit().remove();var h=i.selectAll(".series-group").data(t.series,prop("title"));h.enter().append("g").attr("class","series-group"),h.exit().style("opacity",1e-5).remove();var g=h.selectAll(".line-path").data(function(t){return[t]});g.enter().append("path").attr("class","line-path"),g.style("stroke",prop("color")).attr("d",function(t){return p(t.values)}),g.exit().style("opacity",1e-5).remove();var m=h.selectAll(".line-marker").data(function(t){return t.markerData});m.enter().append("circle").attr("class","line-marker"),m.attr("cy",compose(c,prop("y"))).attr("cx",compose(u,prop("x"))).attr("r",.5*o).style("stroke",prop("color")),m.exit().style("opacity",1e-5).remove()})}var e={top:25,right:20,bottom:25,left:60},r=400,n=200,a=null,o=8;return t.onLineActivated=function(e){return arguments.length?(a=e,t):a},t.width=function(e){return arguments.length?(r=e,t):r},t.height=function(e){return arguments.length?(n=e,t):n},t.title=function(e){return arguments.length?(title=e,t):title},t};
//# sourceMappingURL=../js/scripts.min.js.map