{% extends "layout.html" %}
{% set heading = "Sök ledamöter" %}
{% set header_members_class = "active" %}
{% block title %}{{ heading }}{% endblock %}

{% block head %}
{{ super() }}
<style>
  .twitter-typeahead {
    width: 100%;
  }
  .twitter-typeahead .tt-query,
  .twitter-typeahead .tt-hint {
    margin-bottom: 0px;
  }
  .tt-hint {
    display: block;
    width: 100%;
    height: 38px;
    padding: 8px 12px 12px;
    font-size: 14px;
    line-height: 1.428571429;
    color: #999;
    vertical-align: middle;
    background-color: #ffffff;
    border: 1px solid #cccccc;
    border-radius: 4px;
    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
          box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
    -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;
          transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;
  }
  .tt-dropdown-menu {
    min-width: 160px;
    margin-top: 2px;
    padding: 5px 0;
    background-color: #ffffff;
    border: 1px solid #cccccc;
    border: 1px solid rgba(0, 0, 0, 0.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
          box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);
    background-clip: padding-box;

  }
  .tt-suggestion {
    display: block;
    padding: 3px 20px;
  }
  .tt-suggestion.tt-is-under-cursor {
    color: #fff;
    background-color: #428bca;
  }
  .tt-suggestion.tt-is-under-cursor a {
    color: #fff;
  }
  .tt-suggestion p {
    margin: 0;
  }
</style>
{% endblock %}

{% block content %}
    <div class="row">
      <div class="col-md-5">
        <h1>{{ heading }}</h1>
        <form method="get" action="{{ url_for('members.find') }}" role="form">
          <div class="form-group">
            <div id="member-typeahead">
              <input class="typeahead form-control" type="text" placeholder="Sök ledamot" autocomplete="off" width="300">
            </div>
          </div>
        </form>
      </div>
      <div class="col-md-7">
        {% with messages = get_flashed_messages() %}
        {% if messages -%}
        {% for m in messages -%}
        <div class="alert {{ m.class }}" role="alert">
          {% if m.title %}<strong>{{ m.title }}</strong> {% endif %}{{ m.text }}
        </div>
        {%- endfor %}
        {%- endif %}
        {% endwith %}
        {% if members -%}
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Id</th>
              <th>Namn</th>
              <th>Parti</th>
            </tr>
          </thead>
          <tbody>
            {% for m in members -%}
            <tr>
              <td><a href="/members/{{ m.id }}.html">{{ m.id }}</a></td>
              <td>{{ m.first_name }} {{ m.last_name }}</td>
              <td>{{ m.party.abbr }}</td>
            </tr>
            {%- endfor %}
          </tbody>
        </table>
        {% endif %}
      </div>
    </div>
{% endblock %}

{% block scripts_end %}
<script src="//cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.4/dist/typeahead.bundle.min.js" type="text/javascript"></script>
<script type="text/javascript">
  // constructs the suggestion engine
  var members = new Bloodhound({
    datumTokenizer: Bloodhound.tokenizers.obj.whitespace('full_name'),
    queryTokenizer: Bloodhound.tokenizers.whitespace,
    // `states` is an array of state names defined in "The Basics"
    prefetch: {
      url: '/members/current.json',
      filter: function(obj) {
        return obj.d;
      }
    }
  });

  // kicks off the loading/processing of `local` and `prefetch`
  members.initialize();

  $('#member-typeahead .typeahead').typeahead(null,{
      name: 'members',
      displayKey: function(m) {
        return m.full_name + ' (' + m.party + ')';
      },
      source: members.ttAdapter()
  });
</script>
{% endblock %}